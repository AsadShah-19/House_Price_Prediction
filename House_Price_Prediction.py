# -*- coding: utf-8 -*-
"""House_Price_Prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1s1DtZiWzkB8kqUH82j4sfACknn0p01f6

**House Price Prediction Using Regression Models**
"""

import numpy as np
import pandas as pd
from sklearn.preprocessing import LabelEncoder
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error, r2_score
from sklearn.ensemble import RandomForestRegressor
from sklearn.preprocessing import OneHotEncoder
import matplotlib.pyplot as plt
import seaborn as sns

df = pd.read_csv('Price_PK.csv')

"""EDA:"""

df.head(5)

df.shape

df.isnull().sum()

sns.heatmap(df.isnull(), cbar=False)

df.duplicated().sum()

num_duplicates = df.duplicated().sum()

labels = ['Duplicates', 'Unique']
sizes = [num_duplicates, len(df) - num_duplicates]
colors = ['red', 'green']

plt.pie(sizes, labels=labels, colors=colors, autopct='%1.1f%%')
plt.title('Duplicate vs Unique Rows')
plt.show()

df.shape

df.drop_duplicates(inplace=True)

num_duplicates = df.duplicated().sum()

labels = ['Duplicates', 'Unique']
sizes = [num_duplicates, len(df) - num_duplicates]
colors = ['red', 'green']

plt.pie(sizes, labels=labels, colors=colors, autopct='%1.1f%%')
plt.title('Duplicate vs Unique Rows')
plt.show()

df.shape

df['location'].value_counts()

le = LabelEncoder()
le.fit(df['location'])
df['location'] = le.transform(df['location'])

df['location'].value_counts()

"""*   Bahria Town Rawalpindi: 2
*   Bahria Town: 1
*   Gulistan-e-Johar: 5
*   North Nazimabad: 8
*   Johar Town: 7
*   E-11: 3
*   Adiala Road: 0
*   I-8: 6
*   Satiana Road: 9
*   Eden Gardens: 4
"""

df['city'].value_counts()

le = LabelEncoder()
le.fit(df['city'])
df['city'] = le.transform(df['city'])

df['city'].value_counts()

"""*   Rawalpindi: 4
*   Karachi: 2
*   Lahore: 3
*   Islamabad: 1
*   Faisalabad: 0
"""

df['province_name'].value_counts()

le = LabelEncoder()
le.fit(df['province_name'])
df['province_name'] = le.transform(df['province_name'])

df['province_name'].value_counts()

df['property_type'].value_counts()

le = LabelEncoder()
le.fit(df['property_type'])
df['property_type'] = le.transform(df['property_type'])

df['property_type'].value_counts()

df['purpose'].value_counts()

le = LabelEncoder()
le.fit(df['purpose'])
df['purpose'] = le.transform(df['purpose'])

df['purpose'].value_counts()

df['Area Type'].value_counts()

le = LabelEncoder()
le.fit(df['Area Type'])
df['Area Type'] = le.transform(df['Area Type'])

df['Area Type'].value_counts()

df.describe()

df.info()

"""Outliers:"""

sns.boxplot(x = 'Area Size', data = df)
plt.title('Before IQR')
plt.show()

q1 = df['Area Size'].quantile(0.25)
q3 = df['Area Size'].quantile(0.75)
iqr = q3 - q1
lower_bound = q1 - 1.5 * iqr
upper_bound = q3 + 1.5 * iqr

df = df[(df['Area Size'] >= lower_bound) & (df['Area Size'] <= upper_bound)]

sns.boxplot(x = 'Area Size', data = df)
plt.title('After IQR')
plt.show()

"""Log Transformation:"""

df['longitude'] = np.log1p(df['longitude'])
df['latitude'] = np.log1p(df['latitude'])

plt.figure(figsize=(12, 8))
sns.heatmap(df.corr(), annot=True)
plt.show()

"""Linear Regression:"""

X = df.drop('price', axis=1)
y = df['price']

y_log = np.log1p(y)

X_train, X_test, y_train_log, y_test_log = train_test_split(X, y_log, test_size=0.2, random_state=9)

model = LinearRegression()
model.fit(X_train, y_train_log)

y_pred_log = model.predict(X_test)

y_pred = np.expm1(y_pred_log)
y_test = np.expm1(y_test_log)

mse = mean_squared_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)

print("Mean Squared Error:", mse)
print("R-squared:", r2)

"""Random Forest:"""

X = df.drop('price', axis=1)
y = np.log1p(df['price'])

X = pd.get_dummies(X, drop_first=True)

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=9)

rf = RandomForestRegressor(n_estimators=100, random_state=9)
rf.fit(X_train, y_train)

y_pred_log = rf.predict(X_test)

y_pred = np.expm1(y_pred_log)
y_test_actual = np.expm1(y_test)

mse = mean_squared_error(y_test_actual, y_pred)
r2 = r2_score(y_test_actual, y_pred)

print("Mean Squared Error:", mse)
print("R-squared:", r2)

"""Visualization Of These Algorithms"""

y_pred_lr = np.expm1(y_pred_log)
y_test_lr = np.expm1(y_test_log)

y_pred_rf = np.expm1(y_pred_log)
y_test_rf = np.expm1(y_test_log)

plt.figure(figsize=(14, 5))

plt.subplot(1, 2, 1)
plt.scatter(y_test_lr, y_pred_lr, color='blue', alpha=0.6)
plt.plot([min(y_test_lr), max(y_test_lr)], [min(y_test_lr), max(y_test_lr)], color='red', linestyle='--')
plt.title('Linear Regression: Predicted vs Actual')
plt.xlabel('Actual Prices')
plt.ylabel('Predicted Prices')

plt.subplot(1, 2, 2)
plt.scatter(y_test_rf, y_pred_rf, color='green', alpha=0.6)
plt.plot([min(y_test_rf), max(y_test_rf)], [min(y_test_rf), max(y_test_rf)], color='red', linestyle='--')
plt.title('Random Forest: Predicted vs Actual')
plt.xlabel('Actual Prices')
plt.ylabel('Predicted Prices')

plt.tight_layout()
plt.show()

plt.figure(figsize=(14, 5))


plt.subplot(1, 2, 1)
sns.histplot(y_test_lr - y_pred_lr, kde=True, color='blue')
plt.title('Linear Regression: Residuals')
plt.xlabel('Residuals')
plt.ylabel('Frequency')

plt.subplot(1, 2, 2)
sns.histplot(y_test_rf - y_pred_rf, kde=True, color='green')
plt.title('Random Forest: Residuals')
plt.xlabel('Residuals')
plt.ylabel('Frequency')

plt.tight_layout()
plt.show()

"""Testing the Model"""

import numpy as np
import pandas as pd
from sklearn.linear_model import LinearRegression
from sklearn.ensemble import RandomForestRegressor
from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import train_test_split

X = df.drop('price', axis=1)
y = np.log1p(df['price'])
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

X_train, X_test, y_train, y_test = train_test_split(X_scaled, y, test_size=0.2, random_state=9)

model_lr = LinearRegression()
model_lr.fit(X_train, y_train)

rf = RandomForestRegressor(n_estimators=100, random_state=9)
rf.fit(X_train, y_train)

property_type = int(input("Enter Property Type (Flat = 0, House = 1) : "))
purpose = int(input("Enter Purpose (For Rent = 0, For Sale = 1) : "))
area_type = int(input("Enter Area Type (Kanal = 0, Marla = 1) : "))
area_size = float(input("Enter Area Size: "))
latitude = float(input("Enter Latitude: "))
longitude = float(input("Enter Longitude: "))
bedrooms = int(input("Enter Number of Bedrooms: "))
baths = int(input("Enter Number of Baths: "))
province = int(input("Enter Province (Islamabad Capital = 0, Punjab = 1, Sindh = 2) : "))

if province == 0:
    city = int(input("Enter City (Islamabad = 1) : "))
    location = int(input("Enter Location (E-11 = 3, I-8 = 6) : "))
elif province == 1:
    city = int(input("Enter City (Faisalabad = 0, Lahore = 3, Rawalpindi = 4) : "))
    if city == 0:
        location = int(input("Enter Location (Eden Gardens = 4, Satiana Road = 9) : "))
    elif city == 3:
        location = int(input("Enter Location (Bahria Town = 1, Johar Town = 7) : "))
    elif city == 4:
        location = int(input("Enter Location (Bahria Town Rawalpindi = 2, Adiala Road = 0) : "))
elif province == 2:
    city = int(input("Enter City (Karachi = 2) : "))
    location = int(input("Enter Location (Gulistan-e-Johar = 5, North Nazimabad = 8) : "))

y_pred_lr_log = model_lr.predict(X_scaled)
y_pred_rf_log = rf.predict(X_scaled)

y_pred_lr = np.expm1(y_pred_lr_log)
y_pred_rf = np.expm1(y_pred_rf_log)

print(f"Predicted Price (Linear Regression): {y_pred_lr[0]}")
print(f"Predicted Price (Random Forest): {y_pred_rf[0]}")